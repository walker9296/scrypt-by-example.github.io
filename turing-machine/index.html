<!DOCTYPE html><html class="fa-events-icons-ready" lang="en"><head><meta charset="utf-8"><link href="/favicon.ico" rel="shortcut icon"><meta content="width=device-width,initial-scale=1,shrink-to-fit=yes" name="viewport"><meta content="#000000" name="theme-color"><script src="https://www.google-analytics.com/analytics.js" async type="text/javascript"></script><script src="https://use.fontawesome.com/ba3dde78ee.js"></script><link href="https://www.googletagmanager.com" rel="preconnect"><link href="https://use.fontawesome.com/ba3dde78ee.css" rel="stylesheet" media="all"><link href="/manifest.json" rel="manifest"><title>Turing Machine | sCrypt by Example | 0.1.0</title><script src="https://www.googletagmanager.com/gtag/js?id=UA-133759045-1" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-133759045-1")</script><link href="/static/css/main.1e42c420.chunk.css" rel="stylesheet"><link href="https://use.fontawesome.com" rel="preconnect"><meta content="Turing Machine in sCrypt" name="Description" data-react-helmet="true"><link href="https://www.google-analytics.com" rel="preconnect"></head><body class="light"><noscript>You need to enable JavaScript to run this app.</noscript><script>const theme=localStorage.getItem("theme")||"light";document.body.classList.add(theme)</script><div id="root"><div class="App_component__1bw3C"><div class="Header_component__B9OnK"><a href="/"><img alt="logo" class="Header_logo__2JW7-" src="/static/media/scrypt.dcd88edd.png"></a><h3 class="Header_header__1i3tr"><a href="/">sCrypt by Example</a><div class="Header_versions__lF_Kd"><div class="Header_version__mvWlY"></div></div></h3><img alt="dark mode" class="Header_dark__3mr_R" src="/static/media/mode-dark.faf9339e.svg"></div><div class="App_main__3uArt"><div class="Example_component__2xli-"><div class="Example_content__2bWhi"><h2>Turing Machine</h2><div><p>In the example below, we implement a Turing machine for <a href="https://math.stackexchange.com/questions/503853/how-do-you-argue-or-prove-that-a-certain-turing-machine-accepts-a-language">checking balanced parentheses</a>. Its initial state is A and it contains one accepted state. The transition function says, for instance, if the machine is at state A and its head reads symbol “)”, it should write “X” in that cell and move left, transitioning to state B.</p><p>Structs can be defined like the following:</p><pre><code class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-string">"serializer.scrypt"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">"arrayUtil.scrypt"</span>;


<span class="hljs-comment">// Turing machine state</span>
type <span class="hljs-title class_">State</span> = bytes;
<span class="hljs-comment">// alphabet symbol in each cell, 1 byte long each</span>
type <span class="hljs-title class_">Symbol</span> = bytes;

<span class="hljs-comment">// contract state as a struct</span>
struct <span class="hljs-title class_">StateStruct</span> {
    int headPos;
    bytes tape;
    <span class="hljs-comment">// current machine state</span>
    <span class="hljs-title class_">State</span> curState;
}

struct <span class="hljs-title class_">Input</span> {
    <span class="hljs-title class_">State</span> oldState;
    <span class="hljs-title class_">Symbol</span> read;
}

struct <span class="hljs-title class_">Output</span> {
    <span class="hljs-title class_">State</span> newState;
    <span class="hljs-title class_">Symbol</span> write;
    <span class="hljs-comment">// move left or right</span>
    bool moveLeft;
}

<span class="hljs-comment">// transition function entry: input -> output</span>
struct <span class="hljs-title class_">TransitionFuncEntry</span> {
    <span class="hljs-title class_">Input</span> input;
    <span class="hljs-title class_">Output</span> output;
}

<span class="hljs-comment">/*
 * A Turing Machine checking balanced parentheses
 */</span>
contract <span class="hljs-title class_">TuringMachine</span> {

    @state
    <span class="hljs-title class_">StateStruct</span> states;
    <span class="hljs-comment">// states</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">State</span> <span class="hljs-variable constant_">STATE_A</span> = b<span class="hljs-string">'00'</span>; <span class="hljs-comment">// initial state</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">State</span> <span class="hljs-variable constant_">STATE_B</span> = b<span class="hljs-string">'01'</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">State</span> <span class="hljs-variable constant_">STATE_C</span> = b<span class="hljs-string">'02'</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">State</span> <span class="hljs-variable constant_">STATE_ACCEPT</span> = b<span class="hljs-string">'03'</span>;

    <span class="hljs-comment">// symbols</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">Symbol</span> <span class="hljs-variable constant_">BLANK</span> = b<span class="hljs-string">'00'</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">Symbol</span> <span class="hljs-variable constant_">OPEN</span> = b<span class="hljs-string">'01'</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">Symbol</span> <span class="hljs-variable constant_">CLOSE</span> = b<span class="hljs-string">'02'</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">Symbol</span> X = b<span class="hljs-string">'03'</span>;

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> bool <span class="hljs-variable constant_">LEFT</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> bool <span class="hljs-variable constant_">RIGHT</span> = <span class="hljs-literal">false</span>;

    <span class="hljs-comment">// number of rules in the transition function</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> int N = <span class="hljs-number">8</span>;
    <span class="hljs-comment">// transition function table</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">TransitionFuncEntry</span>[N] transitionFuncTable = [
        ,
        ,
        ,
        ,
        
        ,
        ,

        ,
        
    ];
    
    public <span class="hljs-keyword">function</span> <span class="hljs-title function_">transit</span>(<span class="hljs-params">SigHashPreimage txPreimage</span>) {
        <span class="hljs-comment">// read/deserialize contract state</span>
        <span class="hljs-title class_">SigHashType</span> sigHashType = <span class="hljs-title class_">SigHash</span>.<span class="hljs-property">ANYONECANPAY</span> | <span class="hljs-title class_">SigHash</span>.<span class="hljs-property">SINGLE</span> | <span class="hljs-title class_">SigHash</span>.<span class="hljs-property">FORKID</span>;
        <span class="hljs-built_in">require</span>(<span class="hljs-title class_">Tx</span>.<span class="hljs-title function_">checkPreimageSigHashType</span>(txPreimage, sigHashType));
        <span class="hljs-comment">// transition</span>
        <span class="hljs-title class_">Symbol</span> head = <span class="hljs-title class_">ArrayUtil</span>.<span class="hljs-title function_">getElemAt</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">states</span>.<span class="hljs-property">tape</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">states</span>.<span class="hljs-property">headPos</span>);
        <span class="hljs-comment">// look up in transition table</span>
        bool found = <span class="hljs-literal">false</span>;
        loop (N) : i {
            <span class="hljs-keyword">if</span> (!found) {
                auto entry = transitionFuncTable[i];
                <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">input</span> == { <span class="hljs-variable language_">this</span>.<span class="hljs-property">states</span>.<span class="hljs-property">curState</span>, head }) {
                    auto output = entry.<span class="hljs-property">output</span>;
                    <span class="hljs-comment">// update state</span>
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">states</span>.<span class="hljs-property">curState</span> = output.<span class="hljs-property">newState</span>;
                    <span class="hljs-comment">// write tape head</span>
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">states</span>.<span class="hljs-property">tape</span> = <span class="hljs-title class_">ArrayUtil</span>.<span class="hljs-title function_">setElemAt</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">states</span>.<span class="hljs-property">tape</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">states</span>.<span class="hljs-property">headPos</span>, output.<span class="hljs-property">write</span>);
                    <span class="hljs-comment">// move head</span>
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">states</span>.<span class="hljs-property">headPos</span> += output.<span class="hljs-property">moveLeft</span> ? -<span class="hljs-number">1</span> : <span class="hljs-number">1</span>;
                    <span class="hljs-comment">// extend tape if out of bound</span>
                    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">states</span>.<span class="hljs-property">headPos</span> &lt; <span class="hljs-number">0</span>) {
                        <span class="hljs-comment">// add 1 blank cell to the left</span>
                        <span class="hljs-variable language_">this</span>.<span class="hljs-property">states</span>.<span class="hljs-property">tape</span> = <span class="hljs-variable constant_">BLANK</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">states</span>.<span class="hljs-property">tape</span>;
                        <span class="hljs-variable language_">this</span>.<span class="hljs-property">states</span>.<span class="hljs-property">headPos</span> = <span class="hljs-number">0</span>;
                    }
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">states</span>.<span class="hljs-property">headPos</span> >= <span class="hljs-title function_">len</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">states</span>.<span class="hljs-property">tape</span>)) {
                        <span class="hljs-comment">// add 1 blank cell to the right</span>
                        <span class="hljs-variable language_">this</span>.<span class="hljs-property">states</span>.<span class="hljs-property">tape</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">states</span>.<span class="hljs-property">tape</span> + <span class="hljs-variable constant_">BLANK</span>;
                    }

                    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">states</span>.<span class="hljs-property">curState</span> == <span class="hljs-variable constant_">STATE_ACCEPT</span>) {
                        <span class="hljs-comment">// accept</span>
                        <span class="hljs-title function_">exit</span>(<span class="hljs-literal">true</span>);
                    }

                    found = <span class="hljs-literal">true</span>;
                }
            }
        }
        <span class="hljs-comment">// reject if no transition rule found</span>
        <span class="hljs-built_in">require</span>(found);

        <span class="hljs-comment">// otherwise machine goes to the next step</span>
        bytes stateScript = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getStateScript</span>();
        bytes output = <span class="hljs-title class_">Utils</span>.<span class="hljs-title function_">buildOutput</span>(stateScript, <span class="hljs-title class_">SigHash</span>.<span class="hljs-title function_">value</span>(txPreimage));
        <span class="hljs-built_in">require</span>(<span class="hljs-title function_">hash256</span>(output) == <span class="hljs-title class_">SigHash</span>.<span class="hljs-title function_">hashOutputs</span>(txPreimage));

    }
}
</code></pre></div></div></div></div><div class="App_footer__3TwnI"><div class="Footer_component__2gIOF"><div class="Footer_row__3SCQ6"><img alt="sCrypt" class="Footer_scrypt__-BQ2u" src="/static/media/scrypt.dcd88edd.png"><a href="https://scrypt.io/" target="__blank">sCrypt - A High-Level Language for Bitcoin Smart Contracts.</a></div><div class="Footer_social__3o5aB"><div class="Footer_row__3SCQ6"><img alt="github" class="Footer_github__3ERaz" src="/static/media/github.5994b25b.png"><a href="https://github.com/sCrypt-Inc" target="__blank">GitHub</a></div><div class="Footer_row__3SCQ6"><img alt="medium" class="Footer_medium__3on9R" src="/static/media/medium.04b8f9d1.png"><a href="https://medium.com/@xiaohuiliu" target="__blank">Medium</a></div><div class="Footer_row__3SCQ6"><img alt="slack" class="Footer_slack__2tIs2" src="/static/media/slack.8c80a788.png"><a href="https://join.slack.com/t/scryptworkspace/shared_invite/enQtNzQ1OTMyNDk1ODU3LTJmYjE5MGNmNDZhYmYxZWM4ZGY2MTczM2NiNTIxYmFhNTVjNjE5MGYwY2UwNDYxMTQyNGU2NmFkNTY5MmI1MWM" target="__blank">Slack</a></div><div class="Footer_row__3SCQ6"><img alt="telegram" class="Footer_telegram__24Rdy" src="/static/media/telegram.2c6478d9.png"><a href="https://t.me/joinchat/GwaRAxKT16JjXyHt5PuhHw" target="__blank">Telegram</a></div></div><div class="Footer_row__3SCQ6"><a href="mailto:contact@support@scrypt.io">support@scrypt.io</a></div><div class="Footer_row__3SCQ6"><a href="https://github.com/sCrypt-Inc/scrypt-by-example.github.io" target="__blank">source</a><div class="Footer_bar__3i-Di">|</div><a href="https://github.com/sCrypt-Inc/scrypt-by-example.github.io/blob/gh-pages/LICENSE" target="__blank">license</a></div></div></div></div></div><script>!function(e){function r(r){for(var n,l,p=r[0],a=r[1],f=r[2],c=0,s=[];c<p.length;c++)l=p[c],Object.prototype.hasOwnProperty.call(o,l)&&o[l]&&s.push(o[l][0]),o[l]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);for(i&&i(r);s.length;)s.shift()();return u.push.apply(u,f||[]),t()}function t(){for(var e,r=0;r<u.length;r++){for(var t=u[r],n=!0,p=1;p<t.length;p++){var a=t[p];0!==o[a]&&(n=!1)}n&&(u.splice(r--,1),e=l(l.s=t[0]))}return e}var n={},o={1:0},u=[];function l(r){if(n[r])return n[r].exports;var t=n[r]={i:r,l:!1,exports:{}};return e[r].call(t.exports,t,t.exports,l),t.l=!0,t.exports}l.m=e,l.c=n,l.d=function(e,r,t){l.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,r){if(1&r&&(e=l(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(l.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)l.d(t,n,function(r){return e[r]}.bind(null,n));return t},l.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(r,"a",r),r},l.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},l.p="/";var p=this["webpackJsonpscrypt-by-example"]=this["webpackJsonpscrypt-by-example"]||[],a=p.push.bind(p);p.push=r,p=p.slice();for(var f=0;f<p.length;f++)r(p[f]);var i=a;t()}([])</script><script src="/static/js/2.cd38f460.chunk.js"></script><script src="/static/js/main.b8791219.chunk.js"></script></body></html>