<!DOCTYPE html><html class="fa-events-icons-ready" lang="en"><head><meta charset="utf-8"><link href="/favicon.ico" rel="shortcut icon"><meta content="width=device-width,initial-scale=1,shrink-to-fit=yes" name="viewport"><meta content="#000000" name="theme-color"><script src="https://www.google-analytics.com/analytics.js" async type="text/javascript"></script><script src="https://use.fontawesome.com/ba3dde78ee.js"></script><link href="https://www.googletagmanager.com" rel="preconnect"><link href="https://use.fontawesome.com/ba3dde78ee.css" rel="stylesheet" media="all"><link href="/manifest.json" rel="manifest"><title>Stateful Contract | sCrypt by Example | 0.1.0</title><script src="https://www.googletagmanager.com/gtag/js?id=UA-133759045-1" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-133759045-1")</script><link href="/static/css/main.1e42c420.chunk.css" rel="stylesheet"><link href="https://use.fontawesome.com" rel="preconnect"><link href="https://www.google-analytics.com" rel="preconnect"><meta content="Stateful contracts in sCrypt" name="Description" data-react-helmet="true"></head><body class="light"><noscript>You need to enable JavaScript to run this app.</noscript><script>const theme=localStorage.getItem("theme")||"light";document.body.classList.add(theme)</script><div id="root"><div class="App_component__1bw3C"><div class="Header_component__B9OnK"><a href="/"><img alt="logo" class="Header_logo__2JW7-" src="/static/media/scrypt.dcd88edd.png"></a><h3 class="Header_header__1i3tr"><a href="/">sCrypt by Example</a><div class="Header_versions__lF_Kd"><div class="Header_version__mvWlY"></div></div></h3><img alt="dark mode" class="Header_dark__3mr_R" src="/static/media/mode-dark.faf9339e.svg"></div><div class="App_main__3uArt"><div class="Example_component__2xli-"><div class="Example_content__2bWhi"><h2>Stateful Contract</h2><div><p>Declare any property that is part of the state with <code>@state</code> decorator. The state property can be used the same way as a regular property.</p><p>In order to presist the state, we need to enforce it in the output of the transaction, that will spend our contract in the future. To achieve that, the spending transaction must pass it's transaction preimage.</p><pre><code class="language-javascript">contract <span class="hljs-title class_">Counter</span> {
    @state
    int counter;

    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">int counter</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span> = counter;
    }

    public <span class="hljs-keyword">function</span> <span class="hljs-title function_">increment</span>(<span class="hljs-params">SigHashPreimage txPreimage, int amount</span>) {
        <span class="hljs-comment">// Ensure that the passed preimage is correct for this TX.</span>
        <span class="hljs-built_in">require</span>(<span class="hljs-title class_">Tx</span>.<span class="hljs-title function_">checkPreimage</span>(txPreimage));

        <span class="hljs-comment">// Mutate state.</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span>++;

        <span class="hljs-comment">// Get this TXs output.</span>
        bytes outputScript = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getStateScript</span>();

        <span class="hljs-comment">// Construct an output from its locking script and satoshi amount.</span>
        bytes output = <span class="hljs-title class_">Utils</span>.<span class="hljs-title function_">buildOutput</span>(outputScript, amount);

        <span class="hljs-comment">// Ensure that the TX actually contains this exact output.</span>
        <span class="hljs-built_in">require</span>(<span class="hljs-title function_">hash256</span>(output) == <span class="hljs-title class_">SigHash</span>.<span class="hljs-title function_">hashOutputs</span>(txPreimage));
    }
}
</code></pre></div></div></div></div><div class="App_footer__3TwnI"><div class="Footer_component__2gIOF"><div class="Footer_row__3SCQ6"><img alt="sCrypt" class="Footer_scrypt__-BQ2u" src="/static/media/scrypt.dcd88edd.png"><a href="https://scrypt.io/" target="__blank">sCrypt - A High-Level Language for Bitcoin Smart Contracts.</a></div><div class="Footer_social__3o5aB"><div class="Footer_row__3SCQ6"><img alt="github" class="Footer_github__3ERaz" src="/static/media/github.5994b25b.png"><a href="https://github.com/sCrypt-Inc" target="__blank">GitHub</a></div><div class="Footer_row__3SCQ6"><img alt="medium" class="Footer_medium__3on9R" src="/static/media/medium.04b8f9d1.png"><a href="https://medium.com/@xiaohuiliu" target="__blank">Medium</a></div><div class="Footer_row__3SCQ6"><img alt="slack" class="Footer_slack__2tIs2" src="/static/media/slack.8c80a788.png"><a href="https://join.slack.com/t/scryptworkspace/shared_invite/enQtNzQ1OTMyNDk1ODU3LTJmYjE5MGNmNDZhYmYxZWM4ZGY2MTczM2NiNTIxYmFhNTVjNjE5MGYwY2UwNDYxMTQyNGU2NmFkNTY5MmI1MWM" target="__blank">Slack</a></div><div class="Footer_row__3SCQ6"><img alt="telegram" class="Footer_telegram__24Rdy" src="/static/media/telegram.2c6478d9.png"><a href="https://t.me/joinchat/GwaRAxKT16JjXyHt5PuhHw" target="__blank">Telegram</a></div></div><div class="Footer_row__3SCQ6"><a href="mailto:contact@support@scrypt.io">support@scrypt.io</a></div><div class="Footer_row__3SCQ6"><a href="https://github.com/sCrypt-Inc/scrypt-by-example.github.io" target="__blank">source</a><div class="Footer_bar__3i-Di">|</div><a href="https://github.com/sCrypt-Inc/scrypt-by-example.github.io/blob/gh-pages/LICENSE" target="__blank">license</a></div></div></div></div></div><script>!function(e){function r(r){for(var n,l,p=r[0],a=r[1],f=r[2],c=0,s=[];c<p.length;c++)l=p[c],Object.prototype.hasOwnProperty.call(o,l)&&o[l]&&s.push(o[l][0]),o[l]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);for(i&&i(r);s.length;)s.shift()();return u.push.apply(u,f||[]),t()}function t(){for(var e,r=0;r<u.length;r++){for(var t=u[r],n=!0,p=1;p<t.length;p++){var a=t[p];0!==o[a]&&(n=!1)}n&&(u.splice(r--,1),e=l(l.s=t[0]))}return e}var n={},o={1:0},u=[];function l(r){if(n[r])return n[r].exports;var t=n[r]={i:r,l:!1,exports:{}};return e[r].call(t.exports,t,t.exports,l),t.l=!0,t.exports}l.m=e,l.c=n,l.d=function(e,r,t){l.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,r){if(1&r&&(e=l(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(l.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)l.d(t,n,function(r){return e[r]}.bind(null,n));return t},l.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(r,"a",r),r},l.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},l.p="/";var p=this["webpackJsonpscrypt-by-example"]=this["webpackJsonpscrypt-by-example"]||[],a=p.push.bind(p);p.push=r,p=p.slice();for(var f=0;f<p.length;f++)r(p[f]);var i=a;t()}([])</script><script src="/static/js/2.cd38f460.chunk.js"></script><script src="/static/js/main.b8791219.chunk.js"></script></body></html>